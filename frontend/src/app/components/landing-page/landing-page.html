<!-- HERO -->
<div class="landing-cover">
  <img [src]="urlHelper.getProfilUrl('landing.jpg')" alt="Image de couverture">
  <div class="overlay"></div>
  <div class="landing-text">
    <h1>Bienvenue chez <span>SupermarchÃ© MEAN</span></h1>
    <p>DÃ©couvrez nos magasins et nos produits</p>
    <div class="landing-buttons">
      <button class="landing-btn" (click)="goToregister()">S'inscrire</button>
      <button class="landing-btn2" (click)="goTologin()">Se connecter</button>
    </div>
  </div>
</div>

<!-- TITRE -->
<h1>DÃ©couvrez nos magasins et nos produits</h1>

<!-- BARRE DE FILTRES -->
<div class="filter-bar">
  <input
    type="text"
    [(ngModel)]="searchTerm"
    (input)="searchProduitsGlobaux()"
    placeholder="Rechercher un produit..."
  />
  <select [(ngModel)]="selectedCategorie" (change)="filterByCategorie()">
    <option value="">Toutes les catÃ©gories</option>
    <option *ngFor="let cat of categoriesMagasin" [value]="cat._id">{{ cat.nom }}</option>
  </select>
  <button class="btn-toggle-magasins" (click)="toggleMagasins()">
    {{ showMagasins ? ' Masquer les magasins' : ' Choisir un magasin' }}
  </button>
  <button class="btn-reset" *ngIf="selectedMagasin" (click)="reinitialiserMagasin()">
    âœ• {{ selectedMagasin.nom_magasin }}
  </button>
</div>

<!-- SECTION MAGASINS â€” panneau interactif -->
<div class="magasins-panel" *ngIf="showMagasins">

  <div class="panel-inner">

    <!-- Colonne gauche : sÃ©lecteur d'Ã©tages -->
    <div class="etages-nav">
      <p class="etages-nav-title">Ã‰tages</p>
      <button
        *ngFor="let etage of etages"
        class="etage-btn"
        [class.active]="etageActif === etage"
        (click)="selectionnerEtage(etage)"
      >
        <span class="etage-btn-icon">ğŸ¢</span>
        <span class="etage-btn-label">{{ etage }}</span>
        <span class="etage-btn-count">{{ contratsParEtage[etage].length }}</span>
      </button>
    </div>

    <!-- Colonne droite : boutiques de l'Ã©tage actif -->
    <div class="boutiques-panel">

      <div class="boutiques-panel-header">
        <h3>{{ etageActif }}</h3>
        <span class="boutiques-panel-count">
          {{ boutiquesEtageActif.length }} boutique(s)
        </span>
      </div>

      <div class="boutiques-grid">
        <div
          *ngFor="let contrat of boutiquesEtageActif; let i = index"
          class="boutique-card"
          [class.boutique-selected]="selectedMagasin?._id === contrat._id"
          (click)="selectMagasin(contrat)"
        >
          <!-- Image -->
          <div class="boutique-img-wrap">
            <img
              *ngIf="contrat.imagepath"
              [src]="urlHelper.getMagasinImageUrl(contrat.imagepath)"
              alt="{{ contrat.nom_magasin }}"
            />
            <div *ngIf="!contrat.imagepath" class="boutique-img-placeholder">ğŸª</div>
            <div class="boutique-numero">{{ i + 1 }}</div>
            <!-- Badge sÃ©lectionnÃ© -->
            <div class="boutique-selected-badge" *ngIf="selectedMagasin?._id === contrat._id">
              âœ“
            </div>
          </div>

          <!-- Infos -->
          <div class="boutique-infos">
            <strong class="boutique-nom">{{ contrat.nom_magasin }}</strong>
            <p class="boutique-desc">{{ contrat.description || 'Cliquer pour voir les produits' }}</p>
            <span class="boutique-cta" *ngIf="selectedMagasin?._id !== contrat._id">
              Voir les produits â†’
            </span>
            <span class="boutique-cta boutique-cta-active" *ngIf="selectedMagasin?._id === contrat._id">
              âœ“ SÃ©lectionnÃ© â€” produits affichÃ©s â†“
            </span>
          </div>
        </div>

        <!-- Empty -->
        <div *ngIf="boutiquesEtageActif.length === 0" class="boutiques-empty">
          Aucune boutique Ã  cet Ã©tage.
        </div>
      </div>
    </div>

  </div>
</div>

<!-- SECTION PRODUITS -->
<div class="produits-section">
  <div class="produits-header">
    <div class="produits-header-left">
      <h2 *ngIf="selectedMagasin">
        Produits de <span class="accent">{{ selectedMagasin.nom_magasin }}</span>
      </h2>
      <h2 *ngIf="!selectedMagasin">Tous les produits</h2>
      <p class="produits-count">{{ filteredProduits.length }} produit(s)</p>
    </div>
  </div>

  <div class="produits-grid">
    <div *ngFor="let produit of filteredProduits" class="produit-card">
      <img
        *ngIf="produit.imagepath"
        class="produit-img"
        [src]="urlHelper.getProductImageUrl(produit.imagepath)"
        [alt]="produit.nom"
      />
      <div *ngIf="!produit.imagepath" class="produit-img-placeholder">ğŸ›’</div>
      <div class="produit-content">
        <p class="produit-nom">{{ produit.nom }}</p>
        <p class="produit-description">{{ produit.description }}</p>
        <div class="produit-footer">
          <p *ngIf="produit.prix" class="produit-prix">{{ produit.prix }} Ar</p>
          <p class="produit-stock"
             [class.stock-low]="produit.stock > 0 && produit.stock < 5"
             [class.stock-out]="produit.stock === 0">
            {{ produit.stock > 0 ? 'Stock : ' + produit.stock : 'Rupture' }}
          </p>
        </div>
        <button class="btn-ajouter-panier"
                (click)="goTologin()"
                [disabled]="produit.stock === 0">
          {{ produit.stock > 0 ? '+ Ajouter au panier' : 'Rupture de stock' }}
        </button>
      </div>
    </div>

    <div *ngIf="filteredProduits.length === 0" class="produits-empty">
      <span>ğŸ˜•</span>
      <p>Aucun produit trouvÃ©.</p>
      <small>Essayez d'autres filtres ou sÃ©lectionnez un autre magasin.</small>
    </div>
  </div>
</div>