<!-- src/app/components/panier/panier.component.html -->
<div class="container">
  
  <!-- Header -->
  <div class="header">
    <button class="btn-secondary" (click)="retour()">
      <span class="mdi mdi-arrow-left"></span>
      Retour
    </button>
    <h1>Mon Panier</h1>
    <button 
      class="btn-danger" 
      (click)="viderPanier()"
      *ngIf="panierItems.length > 0">
      <span class="mdi mdi-cart-remove"></span>
      Vider le panier
    </button>
  </div>

  <!-- Panier vide -->
  <div class="panier-vide" *ngIf="panierItems.length === 0">
    <div class="vide-icon">
      <span class="mdi mdi-cart-outline"></span>
    </div>
    <h2>Votre panier est vide</h2>
    <p>Ajoutez des produits depuis nos magasins</p>
    <button class="btn-continuer" (click)="continuerAchats()">
      <span class="mdi mdi-store"></span>
      Continuer mes achats
    </button>
  </div>

  <!-- Liste des produits -->
  <div class="panier-content" *ngIf="panierItems.length > 0">
    
    <div class="produits-liste">
      <div class="produit-item" *ngFor="let item of panierItems">
        
        <!-- Image -->
        <div class="produit-image">
          <img 
            [src]="urlHelper.getProductImageUrl(item.produit.imagepath)"
            [alt]="item.produit.nom"
          />
        </div>

        <!-- Infos -->
        <div class="produit-infos">
          <h3>{{ item.produit.nom }}</h3>
          <p class="magasin-nom">
            <span class="mdi mdi-store-outline"></span>
            {{ item.magasinNom }}
          </p>
          <p class="produit-description">{{ item.produit.description }}</p>
          <p class="stock-info">
            <span class="mdi mdi-package-variant-closed"></span>
            Stock: {{ item.produit.stock }}
          </p>
        </div>

        <!-- Prix unitaire -->
        <div class="produit-prix-unitaire">
          <p class="prix-label">
            <span class="mdi mdi-tag-outline"></span>
            Prix unitaire
          </p>
          <p class="prix-valeur">{{ item.produit.prix }} Ar</p>
        </div>

        <!-- Quantité -->
        <div class="produit-quantite">
          <button 
            class="btn-qty" 
            (click)="diminuerQuantite(item.produit._id)"
            [disabled]="item.quantite <= 1"
            title="Diminuer la quantité">
            <span class="mdi mdi-minus"></span>
          </button>
          <span class="qty-value">{{ item.quantite }}</span>
          <button 
            class="btn-qty" 
            (click)="augmenterQuantite(item.produit._id)"
            [disabled]="item.quantite >= item.produit.stock"
            title="Augmenter la quantité">
            <span class="mdi mdi-plus"></span>
          </button>
        </div>

        <!-- Sous-total -->
        <div class="produit-subtotal">
          <p class="subtotal-label">
            <span class="mdi mdi-currency-usd"></span>
            Sous-total
          </p>
          <p class="subtotal-valeur">{{ item.produit.prix * item.quantite }} Ar</p>
        </div>

        <!-- Bouton supprimer -->
        <button 
          class="btn-supprimer" 
          (click)="retirerProduit(item.produit._id)"
          title="Retirer du panier">
          <span class="mdi mdi-delete-outline"></span>
        </button>

      </div>
    </div>

    <!-- Résumé -->
    <div class="panier-resume">
      <h2>
        <span class="mdi mdi-receipt"></span>
        Résumé de la commande
      </h2>
      
      <div class="resume-ligne">
        <span>
          <span class="mdi mdi-cart-outline"></span>
          Nombre d'articles
        </span>
        <span>{{ panierService.getNombreItems() }}</span>
      </div>

      <div class="resume-ligne total">
        <span>
          <span class="mdi mdi-currency-usd"></span>
          Total
        </span>
        <span class="total-prix">{{ total }} Ar</span>
      </div>

      <button 
        class="btn-valider" 
        (click)="validerCommande()"
        [disabled]="isProcessing">
        <span class="mdi" [class.mdi-check]="!isProcessing" [class.mdi-loading]="isProcessing" [class.mdi-spin]="isProcessing"></span>
        {{ isProcessing ? 'Traitement en cours...' : 'Valider la commande' }}
      </button>

      <button class="btn-continuer" (click)="continuerAchats()">
        <span class="mdi mdi-store"></span>
        Continuer mes achats
      </button>
    </div>

  </div>

</div>