<!-- CARTE -->
<div *ngFor="let etage of etages">
  <h3>Étage {{ etage }}</h3>

  <div class="etage-row">
    <div *ngFor="let contrat of contratsParEtage[etage]" 
         class="magasin-card"
         [style.background-color]="getStatutColor(contrat)"
         (click)="selectMagasin(contrat)">

      <p><strong>{{ contrat.nom_magasin }}</strong></p>
      <p>{{ contrat.description || '' }}</p>

      <img class="magasin-img"
           *ngIf="contrat.imagepath"
           alt="Image du magasin"
           [src]="urlHelper.getMagasinImageUrl(contrat.imagepath)" />
    </div>
  </div>
</div>

<!-- SECTION PRODUITS -->
<div *ngIf="selectedMagasin" class="produits-section">

  <h2>Produits de {{ selectedMagasin.nom_magasin }}</h2>

  <!-- FILTRE -->
  <label>Filtres :</label>
  <select [(ngModel)]="selectedCategorie" (change)="filterByCategorie()">
    <option value="">Toutes les catégories</option>
    <option *ngFor="let cat of categoriesMagasin" [value]="cat._id">
      {{ cat.nom }}
    </option>
  </select>

  <!-- PRODUITS -->
  <div class="produits-grid">
    <div *ngFor="let produit of filteredProduits" class="produit-card">
  
      <img 
        *ngIf="produit.imagepath" 
        class="produit-img"
        [src]="urlHelper.getProductImageUrl(produit.imagepath)"
        [alt]="produit.nom"
      />
  
      <div class="produit-content">
        <p class="produit-nom">{{ produit.nom }}</p>
        <p class="produit-description">{{ produit.description }}</p>
        <p *ngIf="produit.prix" class="produit-prix">
          {{ produit.prix }} Ar
        </p>
      </div>
  
    </div>
  </div>
  
</div>