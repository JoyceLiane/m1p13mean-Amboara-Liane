<!-- src/app/components/admin-dashboard/admin-dashboard.component.html -->
<div class="admin-dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-left">
      <h1> Dashboard Admin</h1>
    </div>
    <button class="btn-logout" (click)="logout()">DÃ©connexion</button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Chargement des donnÃ©es...</p>
  </div>
  <!-- Error -->
  <div *ngIf="error" class="error-message">
    {{ error }}
    <button (click)="loadDashboard()">RÃ©essayer</button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && dashboardData" class="dashboard-content">
    
    <!-- Statistics Cards -->
    <div class="stats-grid">
      <div class="stat-card stat-total">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-info">
          <h3>Total Utilisateurs</h3>
          <p class="stat-value">{{ dashboardData.stats.total }}</p>
        </div>
      </div>

      <div class="stat-card stat-active">
        <div class="stat-icon">âœ…</div>
        <div class="stat-info">
          <h3>Actifs</h3>
          <p class="stat-value">{{ dashboardData.stats.active }}</p>
        </div>
      </div>

      <div class="stat-card stat-inactive">
        <div class="stat-icon">â¸ï¸</div>
        <div class="stat-info">
          <h3>Inactifs</h3>
          <p class="stat-value">{{ dashboardData.stats.inactive }}</p>
        </div>
      </div>

      <div class="stat-card stat-recent">
        <div class="stat-icon">ğŸ†•</div>
        <div class="stat-info">
          <h3>Nouveaux (7j)</h3>
          <p class="stat-value">{{ dashboardData.stats.recent }}</p>
        </div>
      </div>
    </div>

    <!-- Roles Distribution -->
    <div class="roles-section">
      <h3>RÃ©partition par rÃ´le</h3>
      <div class="roles-grid">
        <div *ngFor="let role of roles" class="role-item">
          <span class="role-badge" [ngClass]="getRoleClass(role)">{{ role }}</span>
          <span class="role-count">{{ dashboardData.stats.byRole[role] }}</span>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
      <div class="filter-group">
        <input 
          type="text" 
          [(ngModel)]="searchTerm"
          (ngModelChange)="applyFilters()"
          placeholder="ğŸ” Rechercher par nom, prÃ©nom ou email..."
          class="search-input">
      </div>

      <div class="filter-group">
        <select [(ngModel)]="filterRole" (ngModelChange)="applyFilters()" class="filter-select">
          <option value="all">Tous les rÃ´les</option>
          <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
        </select>

        <select [(ngModel)]="filterStatus" (ngModelChange)="applyFilters()" class="filter-select">
  <option value="all">Tous les statuts</option>
  <option value="actif">Actif</option>
  <option value="inactif">Inactif</option> 
</select>
      </div>
    </div>

    <!-- Users Table -->
    <div class="table-container">
      <table class="users-table">
        <thead>
          <tr>
            <th>Photo</th>
            <th>Nom Complet</th>
            <th>Email</th>
            <th>RÃ´le</th>
            <th>Statut</th>
            <th>CrÃ©Ã© le</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of paginatedUsers">
            <td>
              <img 
                [src]="user.pdp || 'assets/default-avatar.png'" 
                alt="Avatar"
                class="user-avatar">
            </td>
            <td class="user-name">
              {{ user.prenom }} {{ user.nom }}
            </td>
            <td>{{ user.email }}</td>
            <td>
              <span class="badge" [ngClass]="getRoleClass(user.role_id?.nom)">
                {{ user.role_id?.nom }}
              </span>
            </td>
            <td>
              <span class="badge" [ngClass]="getStatusClass(user.statut_id?.nom)">
                {{ user.statut_id?.nom }}
              </span>
            </td>
            <td>{{ user.created_on | date:'dd/MM/yyyy' }}</td>
            <td class="actions-cell">
              <button 
                class="btn-action btn-view" 
                (click)="viewUser(user)"
                title="Voir dÃ©tails">
                ğŸ‘ï¸
              </button>
              <button 
                class="btn-action btn-toggle" 
                (click)="toggleUserStatus(user)"
                title="Changer statut">
                ğŸ”„
              </button>
              <button 
                class="btn-action btn-delete" 
                (click)="confirmDelete(user)"
                title="Supprimer">
                ğŸ—‘ï¸
              </button>
            </td>
          </tr>

          <tr *ngIf="paginatedUsers.length === 0">
            <td colspan="7" class="no-data">
              Aucun utilisateur trouvÃ©
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button 
        (click)="prevPage()" 
        [disabled]="currentPage === 1"
        class="btn-pagination">
        â† PrÃ©cÃ©dent
      </button>
      
      <span class="page-info">
        Page {{ currentPage }} sur {{ totalPages }}
      </span>
      
      <button 
        (click)="nextPage()" 
        [disabled]="currentPage === totalPages"
        class="btn-pagination">
        Suivant â†’
      </button>
    </div>
  </div>

  <!-- User Detail Modal -->
  <div *ngIf="selectedUser" class="modal-overlay" (click)="closeUserView()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>DÃ©tails de l'utilisateur</h2>
        <button class="btn-close" (click)="closeUserView()">âœ•</button>
      </div>
      
      <div class="modal-body">
        <div class="user-detail-header">
          <img 
            [src]="selectedUser.pdp || 'assets/default-avatar.png'" 
            alt="Avatar"
            class="user-detail-avatar">
          <div>
            <h3>{{ selectedUser.prenom }} {{ selectedUser.nom }}</h3>
            <p class="user-email">{{ selectedUser.email }}</p>
          </div>
        </div>

        <div class="user-details">
          <div class="detail-row">
            <span class="detail-label">ğŸ“± TÃ©lÃ©phone:</span>
            <span>{{ selectedUser.phone || 'Non renseignÃ©' }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">ğŸ“ Adresse:</span>
            <span>{{ selectedUser.adresse || 'Non renseignÃ©e' }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">ğŸ‘¤ RÃ´le:</span>
            <span class="badge" [ngClass]="getRoleClass(selectedUser.role_id?.nom)">
              {{ selectedUser.role_id?.nom }}
            </span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label"> Statut:</span>
            <span class="badge" [ngClass]="getStatusClass(selectedUser.statut_id?.nom)">
              {{ selectedUser.statut_id?.nom }}
            </span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">ğŸ“… CrÃ©Ã© le:</span>
            <span>{{ selectedUser.created_on | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
          
          <div class="detail-row" *ngIf="selectedUser.updated_at">
            <span class="detail-label">ğŸ”„ ModifiÃ© le:</span>
            <span>{{ selectedUser.updated_at | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteConfirm" class="modal-overlay" (click)="cancelDelete()">
    <div class="modal-content modal-small" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>âš ï¸ Confirmer la suppression</h2>
      </div>
      
      <div class="modal-body">
        <p>Voulez-vous vraiment supprimer l'utilisateur :</p>
        <p class="delete-user-name">
          <strong>{{ userToDelete?.prenom }} {{ userToDelete?.nom }}</strong>
        </p>
        <p class="warning-text">Cette action est irrÃ©versible !</p>
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" (click)="cancelDelete()">Annuler</button>
        <button class="btn-confirm-delete" (click)="deleteUser()">Supprimer</button>
      </div>
    </div>
  </div>
</div>