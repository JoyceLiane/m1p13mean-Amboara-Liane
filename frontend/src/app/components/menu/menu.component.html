<!-- Bouton toggle -->
<div class="menu-header" [class.collapsed]="isCollapsed">
  <button class="toggle-btn" (click)="toggleCollapse()">
    <!-- MDI: chevron-right / chevron-left -->
    <i [class]="isCollapsed ? 'mdi mdi-chevron-right' : 'mdi mdi-chevron-left'"></i>
  </button>
  
  <div class="theme-toggle" *ngIf="!isCollapsed">
    <button (click)="toggleDarkMode()" class="theme-btn">
      <!-- MDI: white-balance-sunny / moon-waning-crescent -->
      <i [class]="isDarkMode ? 'mdi mdi-white-balance-sunny' : 'mdi mdi-moon-waning-crescent'"></i>
    </button>
  </div>
</div>

<!-- Profil utilisateur -->
<div class="user-profile" *ngIf="currentUser && !isCollapsed">
  <div class="user-avatar">
    <!-- MDI: account-circle -->
    <i class="mdi mdi-account-circle"></i>
  </div>
  <div class="user-info">
    <div class="user-name">{{ currentUser.prenom || 'Utilisateur' }} {{ currentUser.nom || '' }}</div>
    <div class="user-role">{{ getRoleLabel(currentUser.role_id?.nom) }}</div>
  </div>
</div>

<!-- Version réduite du profil -->
<div class="user-profile-collapsed" *ngIf="currentUser && isCollapsed">
  <!-- MDI: account-circle -->
  <i class="mdi mdi-account-circle"></i>
</div>

<!-- Loading -->
<div class="menu-loading" *ngIf="isLoading">
  <!-- MDI: loading (spin) -->
  <i class="mdi mdi-loading mdi-spin"></i> Chargement...
</div>

<!-- Menu dynamique -->
<nav class="menu-nav" [class.collapsed]="isCollapsed" *ngIf="!isLoading">
  <ul class="menu-list">
    <!-- Boucle sur les menus racines -->
    <ng-container *ngFor="let menu of menus; trackBy: trackByMenuId">
      <!-- Menu sans enfant -->
      <li class="menu-item" *ngIf="!hasChildren(menu)">
        <a class="menu-link" 
           [class.active]="isActive(menu.route)"
           (click)="navigateTo(menu.route)"
           [title]="isCollapsed ? menu.title : ''">
          <!-- MDI: dynamic icon from database -->
          <i class="mdi mdi-{{ menu.icon || 'circle' }} menu-icon"></i>
          <span class="menu-title" *ngIf="!isCollapsed">{{ menu.title }}</span>
        </a>
      </li>

      <!-- Menu avec enfants -->
      <li class="menu-item has-submenu" *ngIf="hasChildren(menu)">
        <a class="menu-link" 
           (click)="toggleSubmenu(menu._id, $event)"
           [class.expanded]="expandedMenus[menu._id]">
          <!-- MDI: folder for parent, or icon from db -->
          <i class="mdi mdi-{{ menu.icon || 'folder' }} menu-icon"></i>
          <span class="menu-title" *ngIf="!isCollapsed">{{ menu.title }}</span>
          <!-- MDI: chevron-right for submenu arrow -->
          <i class="mdi mdi-chevron-right submenu-arrow" *ngIf="!isCollapsed" 
             [class.rotated]="expandedMenus[menu._id]"></i>
        </a>
        
        <!-- Sous-menus -->
        <ul class="submenu" *ngIf="expandedMenus[menu._id] && !isCollapsed">
          <li *ngFor="let child of menu.children; trackBy: trackByMenuId">
            <a class="submenu-link"
               [class.active]="isActive(child.route)"
               (click)="navigateTo(child.route)">
              <!-- MDI: icon for child -->
              <i class="mdi mdi-{{ child.icon || 'circle' }} submenu-icon"></i>
              <span class="submenu-title">{{ child.title }}</span>
            </a>
          </li>
        </ul>
      </li>
    </ng-container>

    <!-- Message si aucun menu -->
    <li class="menu-item no-menu" *ngIf="menus.length === 0 && !isCollapsed">
      <span class="menu-link disabled">
        <!-- MDI: information -->
        <i class="mdi mdi-information menu-icon"></i>
        <span class="menu-title">Aucun menu disponible</span>
      </span>
    </li>

    <!-- Séparateur -->
    <li class="menu-divider" *ngIf="menus.length > 0"></li>

    <!-- Déconnexion -->
    <li class="menu-item logout-item">
      <a class="menu-link" (click)="logout()" [title]="isCollapsed ? 'Déconnexion' : ''">
        <!-- MDI: logout -->
        <i class="mdi mdi-logout menu-icon"></i>
        <span class="menu-title" *ngIf="!isCollapsed">Déconnexion</span>
      </a>
    </li>
  </ul>
</nav>