<!-- HEADER AVEC PANIER -->
<div class="header-panier">
  <h1>DÃ©couvrez nos magasins</h1>
  <button class="btn-panier" (click)="voirPanier()" *ngIf="nombreItemsPanier > 0">
    ðŸ›’ Panier ({{ nombreItemsPanier }})
  </button>
</div>

<!-- CARTE -->
<div *ngFor="let etage of etages">
  <h3>Ã‰tage {{ etage }}</h3>

  <div class="etage-row">
    <div *ngFor="let contrat of contratsParEtage[etage]" 
         class="magasin-card"
         [style.background-color]="getStatutColor(contrat)"
         (click)="selectMagasin(contrat)">

      <p><strong>{{ contrat.nom_magasin }}</strong></p>
      <p>{{ contrat.description || '' }}</p>

      <img class="magasin-img"
           *ngIf="contrat.imagepath"
           alt="Image du magasin"
           [src]="urlHelper.getMagasinImageUrl(contrat.imagepath)" />
    </div>
  </div>
</div>

<!-- SECTION PRODUITS -->
<div *ngIf="selectedMagasin" class="produits-section">

  <div class="produits-header">
    <h2>Produits de {{ selectedMagasin.nom_magasin }}</h2>
    
    <!-- Bouton panier flottant (visible uniquement dans la section produits) -->
    <button class="btn-panier-fixed" (click)="voirPanier()" *ngIf="nombreItemsPanier > 0">
      ðŸ›’ {{ nombreItemsPanier }}
    </button>
  </div>

  <!-- FILTRE -->
  <div class="filter-bar">
    <label>Filtres :</label>
    <select [(ngModel)]="selectedCategorie" (change)="filterByCategorie()">
      <option value="">Toutes les catÃ©gories</option>
      <option *ngFor="let cat of categoriesMagasin" [value]="cat._id">
        {{ cat.nom }}
      </option>
    </select>
  </div>

  <!-- PRODUITS -->
  <div class="produits-grid">
    <div *ngFor="let produit of filteredProduits" class="produit-card">
  
      <img 
        *ngIf="produit.imagepath" 
        class="produit-img"
        [src]="urlHelper.getProductImageUrl(produit.imagepath)"
        [alt]="produit.nom"
      />
  
      <div class="produit-content">
        <p class="produit-nom">{{ produit.nom }}</p>
        <p class="produit-description">{{ produit.description }}</p>
        
        <div class="produit-footer">
          <p *ngIf="produit.prix" class="produit-prix">
            {{ produit.prix }} Ar
          </p>
          <p class="produit-stock" [class.stock-low]="produit.stock < 5" [class.stock-out]="produit.stock === 0">
            {{ produit.stock > 0 ? 'Stock: ' + produit.stock : 'Rupture' }}
          </p>
        </div>

        <!-- BOUTON AJOUTER AU PANIER -->
        <button 
          class="btn-ajouter-panier" 
          (click)="ajouterAuPanier(produit, $event)"
          [disabled]="produit.stock === 0">
          {{ produit.stock > 0 ? '+  Ajouter au panier' : 'Rupture de stock' }}
        </button>
      </div>
  
    </div>
  </div>
  
</div>